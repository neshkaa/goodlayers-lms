!function(c){var l=function(a,b){this.options=b;this.$element=c(a);this.$container=c("<div/>",{"class":"ms-container"});this.$selectableContainer=c("<div/>",{"class":"ms-selectable"});this.$selectionContainer=c("<div/>",{"class":"ms-selection"});this.$selectableUl=c("<ul/>",{"class":"ms-list",tabindex:"-1"});this.$selectionUl=c("<ul/>",{"class":"ms-list",tabindex:"-1"});this.scrollTo=0;this.elemsSelector="li:visible:not(.ms-optgroup-label,.ms-optgroup-container,."+b.disabledClass+")"};l.prototype=
{constructor:l,init:function(){var a=this,b=this.$element;if(0===b.next(".ms-container").length){b.css({position:"absolute",left:"-9999px"});b.attr("id",b.attr("id")?b.attr("id"):Math.ceil(1E3*Math.random())+"multiselect");this.$container.attr("id","ms-"+b.attr("id"));this.$container.addClass(a.options.cssClass);b.find("option").each(function(){a.generateLisFromOption(this)});this.$selectionUl.find(".ms-optgroup-label").hide();a.options.selectableHeader&&a.$selectableContainer.append(a.options.selectableHeader);
a.$selectableContainer.append(a.$selectableUl);a.options.selectableFooter&&a.$selectableContainer.append(a.options.selectableFooter);a.options.selectionHeader&&a.$selectionContainer.append(a.options.selectionHeader);a.$selectionContainer.append(a.$selectionUl);a.options.selectionFooter&&a.$selectionContainer.append(a.options.selectionFooter);a.$container.append(a.$selectableContainer);a.$container.append(a.$selectionContainer);b.after(a.$container);a.activeMouse(a.$selectableUl);a.activeKeyboard(a.$selectableUl);
var d=a.options.dblClick?"dblclick":"click";a.$selectableUl.on(d,".ms-elem-selectable",function(){a.select(c(this).data("ms-value"))});a.$selectionUl.on(d,".ms-elem-selection",function(){a.deselect(c(this).data("ms-value"))});a.activeMouse(a.$selectionUl);a.activeKeyboard(a.$selectionUl);b.on("focus",function(){a.$selectableUl.focus()})}b=b.find("option:selected").map(function(){return c(this).val()}).get();a.select(b,"init");"function"===typeof a.options.afterInit&&a.options.afterInit.call(this,
this.$container)},generateLisFromOption:function(a,b,d){var e=this,f=e.$element;d="";for(var g=c(a),h=0;h<a.attributes.length;h++){var k=a.attributes[h];"value"!==k.name&&"disabled"!==k.name&&(d+=k.name+'="'+k.value+'" ')}a=c("<li "+d+"><span>"+e.escapeHTML(g.text())+"</span></li>");d=a.clone();h=g.val();k=e.sanitize(h);a.data("ms-value",h).addClass("ms-elem-selectable").attr("id",k+"-selectable");d.data("ms-value",h).addClass("ms-elem-selection").attr("id",k+"-selection").hide();if(g.attr("disabled")||
f.attr("disabled"))d.addClass(e.options.disabledClass),a.addClass(e.options.disabledClass);var m=g.parent("optgroup");0<m.length?(k=m.attr("label"),f=e.sanitize(k),g=e.$selectableUl.find("#optgroup-selectable-"+f),h=e.$selectionUl.find("#optgroup-selection-"+f),0===g.length&&(k='<ul class="ms-optgroup"><li class="ms-optgroup-label"><span>'+k+"</span></li></ul>",g=c('<li class="ms-optgroup-container"></li>'),h=c('<li class="ms-optgroup-container"></li>'),g.attr("id","optgroup-selectable-"+f),h.attr("id",
"optgroup-selection-"+f),g.append(c(k)),h.append(c(k)),e.options.selectableOptgroup&&(g.find(".ms-optgroup-label").on("click",function(){var a=m.children(":not(:selected, :disabled)").map(function(){return c(this).val()}).get();e.select(a)}),h.find(".ms-optgroup-label").on("click",function(){var a=m.children(":selected:not(:disabled)").map(function(){return c(this).val()}).get();e.deselect(a)})),e.$selectableUl.append(g),e.$selectionUl.append(h)),b=void 0===b?g.find("ul").children().length:b+1,a.insertAt(b,
g.children()),d.insertAt(b,h.children())):(b=void 0===b?e.$selectableUl.children().length:b,a.insertAt(b,e.$selectableUl),d.insertAt(b,e.$selectionUl))},addOption:function(a){var b=this;void 0!==a.value&&null!==a.value&&(a=[a]);c.each(a,function(a,e){if(void 0!==e.value&&null!==e.value&&0===b.$element.find("option[value='"+e.value+"']").length){var d=c('<option value="'+e.value+'">'+e.text+"</option>"),g=void 0===e.nested?b.$element:c("optgroup[label='"+e.nested+"']");a=parseInt("undefined"===typeof e.index?
g.children().length:e.index);e.optionClass&&d.addClass(e.optionClass);e.disabled&&d.prop("disabled",!0);d.insertAt(a,g);b.generateLisFromOption(d.get(0),a,e.nested)}})},escapeHTML:function(a){return c("<div>").text(a).html()},activeKeyboard:function(a){var b=this;a.on("focus",function(){c(this).addClass("ms-focus")}).on("blur",function(){c(this).removeClass("ms-focus")}).on("keydown",function(d){switch(d.which){case 40:case 38:d.preventDefault();d.stopPropagation();b.moveHighlight(c(this),38===d.which?
-1:1);return;case 37:case 39:d.preventDefault();d.stopPropagation();b.switchList(a);return;case 9:if(b.$element.is("[tabindex]")){d.preventDefault();var e=parseInt(b.$element.attr("tabindex"),10);e=d.shiftKey?e-1:e+1;c('[tabindex="'+e+'"]').focus();return}d.shiftKey&&b.$element.trigger("focus")}-1<c.inArray(d.which,b.options.keySelect)&&(d.preventDefault(),d.stopPropagation(),b.selectHighlighted(a))})},moveHighlight:function(a,b){var d=a.find(this.elemsSelector),e=d.filter(".ms-hover"),c=null,g=d.first().outerHeight(),
h=a.height();this.$container.prop("id");d.removeClass("ms-hover");1===b?(c=e.nextAll(this.elemsSelector).first(),0===c.length&&(b=e.parent(),b.hasClass("ms-optgroup")?(b=b.parent(),b=b.next(":visible"),c=0<b.length?b.find(this.elemsSelector).first():d.first()):c=d.first())):-1===b&&(c=e.prevAll(this.elemsSelector).first(),0===c.length&&(b=e.parent(),b.hasClass("ms-optgroup")?(b=b.parent(),b=b.prev(":visible"),c=0<b.length?b.find(this.elemsSelector).last():d.last()):c=d.last()));0<c.length&&(c.addClass("ms-hover"),
d=a.scrollTop()+c.position().top-h/2+g/2,a.scrollTop(d))},selectHighlighted:function(a){var b=a.find(this.elemsSelector),d=b.filter(".ms-hover").first();0<d.length&&(a.parent().hasClass("ms-selectable")?this.select(d.data("ms-value")):this.deselect(d.data("ms-value")),b.removeClass("ms-hover"))},switchList:function(a){a.blur();this.$container.find(this.elemsSelector).removeClass("ms-hover");a.parent().hasClass("ms-selectable")?this.$selectionUl.focus():this.$selectableUl.focus()},activeMouse:function(a){var b=
this;this.$container.on("mouseenter",b.elemsSelector,function(){c(this).parents(".ms-container").find(b.elemsSelector).removeClass("ms-hover");c(this).addClass("ms-hover")});this.$container.on("mouseleave",b.elemsSelector,function(){c(this).parents(".ms-container").find(b.elemsSelector).removeClass("ms-hover")})},refresh:function(){this.destroy();this.$element.multiSelect(this.options)},destroy:function(){c("#ms-"+this.$element.attr("id")).remove();this.$element.off("focus");this.$element.css("position",
"").css("left","");this.$element.removeData("multiselect")},select:function(a,b){"string"===typeof a&&(a=[a]);var d=this,e=this.$element,f=c.map(a,function(a){return d.sanitize(a)}),g=this.$selectableUl.find("#"+f.join("-selectable, #")+"-selectable").filter(":not(."+d.options.disabledClass+")"),h=this.$selectionUl.find("#"+f.join("-selection, #")+"-selection").filter(":not(."+d.options.disabledClass+")"),k=e.find("option:not(:disabled)").filter(function(){return-1<c.inArray(this.value,a)});"init"===
b&&(g=this.$selectableUl.find("#"+f.join("-selectable, #")+"-selectable"),h=this.$selectionUl.find("#"+f.join("-selection, #")+"-selection"));0<g.length&&(g.addClass("ms-selected").hide(),h.addClass("ms-selected").show(),k.attr("selected","selected"),d.$container.find(d.elemsSelector).removeClass("ms-hover"),f=d.$selectableUl.children(".ms-optgroup-container"),0<f.length?(f.each(function(){var a=c(this).find(".ms-elem-selectable");a.length===a.filter(".ms-selected").length&&c(this).find(".ms-optgroup-label").hide()}),
d.$selectionUl.children(".ms-optgroup-container").each(function(){0<c(this).find(".ms-elem-selection").filter(".ms-selected").length&&c(this).find(".ms-optgroup-label").show()})):d.options.keepOrder&&"init"!==b&&(f=d.$selectionUl.find(".ms-selected"),1<f.length&&f.last().get(0)!=h.get(0)&&h.insertAfter(f.last())),"init"!==b&&(e.trigger("change"),"function"===typeof d.options.afterSelect&&d.options.afterSelect.call(this,a)))},deselect:function(a){"string"===typeof a&&(a=[a]);var b=this,d=this.$element,
e=c.map(a,function(a){return b.sanitize(a)}),f=this.$selectableUl.find("#"+e.join("-selectable, #")+"-selectable");e=this.$selectionUl.find("#"+e.join("-selection, #")+"-selection").filter(".ms-selected").filter(":not(."+b.options.disabledClass+")");var g=d.find("option").filter(function(){return-1<c.inArray(this.value,a)});0<e.length&&(f.removeClass("ms-selected").show(),e.removeClass("ms-selected").hide(),g.removeAttr("selected"),b.$container.find(b.elemsSelector).removeClass("ms-hover"),f=b.$selectableUl.children(".ms-optgroup-container"),
0<f.length&&(f.each(function(){0<c(this).find(".ms-elem-selectable").filter(":not(.ms-selected)").length&&c(this).find(".ms-optgroup-label").show()}),b.$selectionUl.children(".ms-optgroup-container").each(function(){0===c(this).find(".ms-elem-selection").filter(".ms-selected").length&&c(this).find(".ms-optgroup-label").hide()})),d.trigger("change"),"function"===typeof b.options.afterDeselect&&b.options.afterDeselect.call(this,a))},select_all:function(){var a=this.$element,b=a.val();a.find('option:not(":disabled")').attr("selected",
"selected");this.$selectableUl.find(".ms-elem-selectable").filter(":not(."+this.options.disabledClass+")").addClass("ms-selected").hide();this.$selectionUl.find(".ms-optgroup-label").show();this.$selectableUl.find(".ms-optgroup-label").hide();this.$selectionUl.find(".ms-elem-selection").filter(":not(."+this.options.disabledClass+")").addClass("ms-selected").show();this.$selectionUl.focus();a.trigger("change");"function"===typeof this.options.afterSelect&&(a=c.grep(a.val(),function(a){return 0>c.inArray(a,
b)}),this.options.afterSelect.call(this,a))},deselect_all:function(){var a=this.$element,b=a.val();a.find("option").removeAttr("selected");this.$selectableUl.find(".ms-elem-selectable").removeClass("ms-selected").show();this.$selectionUl.find(".ms-optgroup-label").hide();this.$selectableUl.find(".ms-optgroup-label").show();this.$selectionUl.find(".ms-elem-selection").removeClass("ms-selected").hide();this.$selectableUl.focus();a.trigger("change");"function"===typeof this.options.afterDeselect&&this.options.afterDeselect.call(this,
b)},sanitize:function(a){var b=0;if(0==a.length)return b;var d;var c=0;for(d=a.length;c<d;c++){var f=a.charCodeAt(c);b=(b<<5)-b+f;b|=0}return b}};c.fn.multiSelect=function(){var a=arguments[0],b=arguments;return this.each(function(){var d=c(this),e=d.data("multiselect"),f=c.extend({},c.fn.multiSelect.defaults,d.data(),"object"===typeof a&&a);e||d.data("multiselect",e=new l(this,f));if("string"===typeof a)e[a](b[1]);else e.init()})};c.fn.multiSelect.defaults={keySelect:[32],selectableOptgroup:!1,disabledClass:"disabled",
dblClick:!1,keepOrder:!1,cssClass:""};c.fn.multiSelect.Constructor=l;c.fn.insertAt=function(a,b){return this.each(function(){0===a?b.prepend(this):b.children().eq(a-1).after(this)})}}(window.jQuery);