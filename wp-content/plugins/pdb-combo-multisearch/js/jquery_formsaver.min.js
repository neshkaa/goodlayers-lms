(function(d){function e(e,f){var g=function(a){return"formdata__$url__$extra".replace("$url",location.pathname).replace("$extra",a.attr("id")||"")}(f),h={save:function(){this._save(g,this.extractValues())},restore:function(){this.fillFields(this._load(g))},clear:function(){this._remove(g)},has_saved:function(){jQuery.isEmptyObject(this._load(g))||f.addClass("formsaved")},extractValues:function(){var a=f.find(":input[name]").not("[type=hidden]").serializeArray(),c={};d.each(a,function(b,a){b=a.name;
a=encodeURIComponent(a.value);c[b]=c[b]?c[b]instanceof Array?c[b].concat(a):[c[b],a]:a});return c},fillFields:function(a){d.each(a,function(a,b){a=f.find('[name="'+a+'"]:not([type=hidden])');var c=a.prop("type");b=b instanceof Array?b.map(decodeURIComponent):decodeURIComponent(b);if("checkbox"===c){var e=b instanceof Array?b:[b];a.each(function(){var a=d(this);a.prop("checked",-1!==e.indexOf(a.val()))})}else"radio"===c?a.filter("[value="+b+"]").prop("checked",!0):a.val(b).trigger("chosen:updated")})},
_save:function(a,c){localStorage[a]=JSON.stringify(c)},_load:function(a){return localStorage[a]?JSON.parse(localStorage[a]):{}},_remove:function(a){localStorage.removeItem(a)}};d.each(e instanceof Array?e:[e],function(a,c){h[c]()})}d.fn.saveForm=function(){e("save",d(this))};d.fn.restoreForm=function(){e(["restore","clear"],d(this))};d.fn.clearSavedForm=function(){e("clear",d(this))};d.fn.hasSavedForm=function(){e("has_saved",d(this))}})(jQuery);