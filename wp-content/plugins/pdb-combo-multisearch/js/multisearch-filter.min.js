PDbListFilter=function(c){var h=!1,p=c(".multisearch .pdb-searchform .pdb-error"),q=c('.multisearch .sort_filter_form[data-ref="update"]'),u=c('.multisearch .sort_filter_form[data-ref="remote"]'),e={},f={},v=function(){e={filterNonce:PDb_ajax.filterNonce,postID:PDb_ajax.postID}},g=function(a,b){b=b||!1;a.preventDefault?a.preventDefault():a.returnValue=!1;k();var d=A(a.target);a=c(a.target);var l=a.closest("."+PDb_ajax.prefix+"searchform"),m=l.find(".sort_filter_form"),g=l.find("input[type=submit]").prop("disabled",
!0),n=function(){g.prop("disabled",!1)};c("html").on("pdbListFilterComplete",function(){n()});e.submit=a.data("submit");switch(e.submit){case "search":e.listpage="1";w(a);HTMLFormElement.prototype.reportValidity&&!m[0].reportValidity()&&(h=!0);!1===x(!0)&&!1===x()&&(p.show(),l.find(".value_error").slideDown(200),h=!0);if(h){n();return}"1"===PDbCMS.restore_search&&m.saveForm();break;case "clear":B(a);f={};r(l);e.listpage="1";e.action="pdb_list_filter";m.clearSavedForm();m.removeClass("formsaved");
break;case "page":e.target_instance=e.instance_index;e.action="pdb_list_filter";e.listpage=d.data("page");r(d.closest(".pdb-list").find(".sort_filter_form"));break;case "sort":e.listpage="1";w(a);break;default:n();return}b?("clear"!==e.submit&&(0===a.closest("form").find("[name=submit_button]").length&&a.closest("form").append(c("<input>",{type:"hidden",name:"submit_button",value:a.val()})),a.closest("form").submit()),n()):(jQuery.extend(e,f),f={},a.PDb_processSubmission())},x=function(a){a=a||!1;
var b=[],d;for(d in f)switch(d){case "combo_search":b.push(a&&t(f[d]));case "ascdesc":case "sortBy":break;default:b.push(C(f[d],"text"===c('.sort_filter_form input[name="'+d+'"]').prop("type")?!1:!0)&&(f.search_field?"none"!==f.search_field:!0))}a:if(0===b.length)b=!1;else{a=!0;for(d=0;d<b.length;d++)if("0"==PDbCMS.require_all&&b[d]){b=!0;break a}else a=a&&b[d];b=a}return b},C=function(a,b){b|=0;if(Array.isArray(a)){for(var d=0;d<a.length;d++)if(t(a[d],b))return!0;return!1}return t(a,b)},t=function(a,
b){b=b||!1;return a.replace(/(\*|\?|_|%)/g,"").length>=(b?1:PDbCMS.min_term_length)},w=function(a){var b=a.closest("form");b.length||(b=a.closest(".pdb-list").find(".sort_filter_form"));b.find('input[name$="[start]"]').each(function(){var a=c(this),b=c('input[name="'+a.prop("name").replace("[start]","[end]")+'"]');""!==a.val()&&""===b.val()?b.prop("max")?b.val(b.prop("max")):b.data("default")&&b.val(b.data("default")):""===a.val()&&""!==b.val()&&(a.prop("min")?a.val(a.prop("min")):a.data("default")&&
a.val(a.data("default")))});b.find('input:not(input[type="submit"],input[type="radio"],input[type="checkbox"],input[type="hidden"], input:not([name])), select').each(function(){y(c(this))});b.find('input[type="radio"]:checked, input[type="checkbox"]:checked').each(function(){y(c(this))});r(b)},r=function(a){a.find('input[type="hidden"]').each(function(){var a=c(this);e[a.attr("name")]=a.val()})},A=function(a){a=c(a);return a.is("a")?a:a.closest("a")},D=function(a){g(a,!0)},E=function(a){c(a.target).data("submit",
"page");var b=c(a.target).closest(".wrap.pdb-list").prop("class").match(/pdb-instance-(\d+)/);e.instance_index=b[1];g(a)},k=function(a){a=a||!1;h&&p.children().slideUp(200,function(){p.hide();a&&c("html").trigger("pdbcms-init")});h=!1},B=function(a){a=a.closest("form");a.find("input:not([type=hidden],[type=submit]), select").PDb_clearInputs();a.find('input[name="combo_search"]').PDb_clearInputs();a=a.find("[name=text_search_options]");a.length&&a.filter("#pdb-text_search_options-"+a.data("default")).prop("checked",
!0);k()},z=function(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)a[b]=z(a[b]);return a}return encodeURI(a)},y=function(a){var b=a.attr("name"),c=a.is("[multiple]")||/\[\]$/.test(b);a=z(a.val()||"");b=b.replace("[]","");c&&"string"===typeof f[b]&&(f[b]=[f[b]]);if("object"===typeof f[b])f[b][f[b].length]=a;else if("text_search_options"===b||"any"!==a)f[b]=a},F=function(a){var b=c(".pdb-list.pdb-instance-"+e.instance_index),d=b.length?b:c(".pdb-list").first(),f=d.find(".pdb-pagination"),g=a.closest("fieldset, div"),
h=c(PDb_ajax.loading_indicator).clone();c.ajax({type:"POST",url:PDb_ajax.ajaxurl,data:e,beforeSend:function(){g.append(h)},success:function(b,e){if(b.match(/^failed/))switch(a.data("submit")){case "page":e=document.createElement("a");e.href=window.location.href;window.location.href=e.protocol+"//"+e.hostname+a.attr("href");break;default:a.before('<input type="hidden" name="submit" value="'+a.data("submit")+'" />'),a.trigger("click.multisearch",!0)}b=c(b);e=b.find(".pdb-pagination");var g=b.find(".list-container").length?
b.find(".list-container"):b;b.PDb_idFix();g.find("a.obfuscate[data-email-values]").each(function(){c(this).PDb_email_obfuscate()});d.find(".list-container").replaceWith(g);f.remove();e.length&&e.each(function(){(d.find(".list-container + .pdb-pagination").length?d.find(".list-container + .pdb-pagination").last():d.find(".list-container")).after(this)});h.remove();v();c("html").trigger("pdbListAjaxComplete")},error:function(a,b,c){console.log("Participants Database JS error status:"+b+" error:"+c)}})};
c.fn.PDb_idFix=function(){this.find("#pdb-list").addClass("list-container").removeAttr("id");this.find("#sort_filter_form").addClass("sort_filter_form").removeAttr("id")};c.fn.PDb_checkInputs=function(a){var b=this.length,d=0;this.each(function(){c(this).val()===a&&d++});return d===b};c.fn.PDb_clearInputs=function(a){a=a||"";this.each(function(){var b=c(this);b.is("[type=checkbox],[type=radio]")?b.prop("checked","any"===b.val()||""!==a):(b.find("[value=any]").length?b.val("any"):b.val(a),b.chosen&&
b.trigger("chosen:updated"))})};c.fn.PDb_processSubmission=function(){F(this)};return{run:function(){"undefined"===typeof PDb_ajax.prefix&&(PDb_ajax.prefix="pdb-");c(".wrap.pdb-list").PDb_idFix();k(!0);v();q.on("click.multisearch",'[type="submit"]',g);u.on("click.multisearch",'[type="submit"]',D);q.on("focus",".search-control input[type!=submit],select",k);u.on("focus",".search-control input[type!=submit],select",k);var a=c(".pdb-searchform .sort_filter_form");PDbCMS.remote_search&&"1"===PDbCMS.restore_search&&
a.saveForm();a.hasSavedForm();if("1"===PDbCMS.restore_search&&a.hasClass("formsaved"))c("html").on("pdbcms-init",function(){a.restoreForm();q.find("[data-submit=search]").trigger("click.multisearch")});c(".pdb-list").on("click.page",".pdb-pagination a",E);c("html").on("pdbListAjaxComplete",function(){c("html").trigger("pdbListFilterComplete")})},submit_search:g}}(jQuery);jQuery(function(){PDbListFilter.run()});